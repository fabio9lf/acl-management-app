name: lab

topology:
  nodes:
    r1:
      kind: linux
      image: frr-ssh
      mgmt-ipv4: 172.20.20.2
      binds:
        - ./configs/frr-daemons.cfg:/etc/frr/daemons
        - ./configs/r1/frr.conf:/etc/frr/frr.conf
        - ./configs/r1/iptables.rules:/etc/iptables/rules.v4
      exec:
        - /bin/bash -c "iptables-restore < /etc/iptables/rules.v4"
    h1:
      kind: linux
      image: alpine-ssh:latest
      mgmt-ipv4: 172.20.20.3
      binds:
        - ./configs/h1/startup.sh:/startup.sh
      exec:
        - /bin/sh /startup.sh
    h2:
      kind: linux
      image: alpine-ssh:latest
      mgmt-ipv4: 172.20.20.4
      binds:
        - ./configs/h2/startup.sh:/startup.sh
      exec:
        - /bin/sh /startup.sh
    h3:
      kind: linux
      image: alpine-ssh:latest
      mgmt-ipv4: 172.20.20.5
      binds:
        - ./configs/h3/startup.sh:/startup.sh
      exec:
        - /bin/sh /startup.sh
  links:   
    - endpoints: ["r1:eth1", "h1:eth1"]
    - endpoints: ["r1:eth2", "h2:eth1"]
    - endpoints: ["r1:eth3", "h3:eth1"]

