============================= test session starts ==============================
platform linux -- Python 3.11.2, pytest-7.2.1, pluggy-1.0.0+repack
Test della insert della policy con DROP dei pacchetti di tipo udp da LAN1 (192.168.10.0/24) a h2 (192.168.20.2)
rootdir: /home/clab/tesi_LaFalce/src/tests, configfile: pytest.ini
collected 1 item

tests/test_udp.py .                                                      [100%]

============================== 1 passed in 0.63s ===============================
============================= test session starts ==============================
platform linux -- Python 3.11.2, pytest-7.2.1, pluggy-1.0.0+repack
Test della remove della policy con DROP dei pacchetti di tipo tcp da h1 (192.168.10.2) a h3 (192.168.30.2)
rootdir: /home/clab/tesi_LaFalce/src/tests, configfile: pytest.ini
collected 1 item

tests/test_tcp.py F                                                      [100%]

=================================== FAILURES ===================================
___________________________________ test_tcp ___________________________________

rule = {'dest_node': {'ip': '192.168.30.2', 'mgmt_ip': '172.20.20.5', 'nexthop': 'r1', 'nome': 'h3'}, 'line_number': '3', 'protocollo': 'tcp', 'src_node': {'ip': '192.168.10.2', 'mgmt_ip': '172.20.20.3', 'nexthop': 'r1', 'nome': 'h1'}, ...}
type = {'nome': 'remove'}

    def test_tcp(rule, type):
        client_dest = setup_connection(rule["dest_node"]["mgmt_ip"], "root", "root")
    
        command = f"sh -c 'nc -l -p 5000 &'"
        execute_command(client_dest, command)
    
        client_src = setup_connection(rule["src_node"]["mgmt_ip"], "root", "root")
        command = "sh -c 'nc -v -w3 " +  rule['dest_node']['ip'] + " 5000'"
        stdin, stdout, stderr = execute_command(client_src, command)
    
        returncode = stdout.channel.recv_exit_status()
    
        close_connection(client=client_src)
        close_connection(client=client_dest)
        if rule["target"] == "ACCEPT":
            if type["nome"] == "insert":
                assert returncode == 0
            else:
                assert returncode != 0
        else:
            if type["nome"] == "insert":
                assert returncode != 0
            else:
>               assert returncode == 0
E               assert 1 == 0

tests/test_tcp.py:27: AssertionError
=========================== short test summary info ============================
FAILED tests/test_tcp.py::test_tcp - assert 1 == 0
============================== 1 failed in 3.72s ===============================
