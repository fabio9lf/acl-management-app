name: lab

topology:
  groups:
    router:
      kind: linux
      image: frr-ssh
      binds:
        - ./configs/frr-daemons.cfg:/etc/frr/daemons
        - ./configs/__clabNodeName__/frr.conf:/etc/frr/frr.conf
        - ./configs/__clabNodeName__/iptables.rules:/etc/iptables/rules.v4
      exec:
        - /bin/bash -c "iptables-restore < /etc/iptables/rules.v4"
    host:
      kind: linux
      image: alpine-ssh:latest
      binds:
        - ./configs/__clabNodeName__/startup.sh:/startup.sh
      exec:
        - /bin/sh /startup.sh
  nodes:
    r1:
      mgmt-ipv4: 172.20.20.2
      group: router
    r2:
      mgmt-ipv4: 172.20.20.3
      group: router
    r3:
      group: router
      mgmt-ipv4: 172.20.20.4
    h1:
      mgmt-ipv4: 172.20.20.5
      group: host
    h2:
      mgmt-ipv4: 172.20.20.6
      group: host
    h3:
      mgmt-ipv4: 172.20.20.7
      group: host
  links:   
    - endpoints: ["r1:eth2", "r2:eth2"]
    - endpoints: ["r1:eth3", "r3:eth2"]
    - endpoints: ["r2:eth3", "r3:eth3"]
    - endpoints: ["r1:eth1", "h1:eth1"]
    - endpoints: ["r2:eth1", "h2:eth1"]
    - endpoints: ["r3:eth1", "h3:eth1"]

